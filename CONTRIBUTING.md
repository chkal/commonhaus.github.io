# Contributing to Commonhaus Foundation Website

We appreciate your interest in contributing to our project! This document provides some basic guidelines for contributing.

## Deno, Lume and Vento

This project uses [Deno](https://deno.land/) as the runtime, the [Lume static site generator](https://lume.land/) and [Vento templating engine](https://vento.js.org/).

## Setup

1. **Checkout this repository and all recursive submodules**

    You can do this by running the following command:

    ```bash
    git clone --recursive <https://github.com/commonhaus/commonhaus.github.io.git>
    ```

2. **Install Deno**

   Install it by following the instructions on the [Deno website](https://deno.land/#installation).

3. **Serve the website**

    You can serve the website locally by running the following command:

    ```bash
    deno task serve
    ```

    Other tasks are available (in `deno.json`, list with `deno task`):

    - `build`: Builds the website (first Lume, then Vite+Svelte)
    - **Lume**
        - `attach`: Attaches a debugger to lume.
        - `debug`: Allows you to attach a debugger to a deno task.
        - `serve`: Builds and serves the website, and watch for changes.
    - **Vite** (Membership UI, run after Lume)
        - `vite-build`: use vite to compile svelte files
        - `vite-dev`: use vite to watch and recompile svelte files
    - **Generation**
        - `about`: Update metadata about members of the foundation based on the CONTACTS list.
        - `activity`: Query the latest discussions and PRs from the foundation repository and update corresponding site pages (requires GH CLI).
        - `lastmod`: update information about the contents of the foundation submodule (requires GH CLI).
        - `votes`: Update metadata related to a vote (discussion or PR)
    - **Verification**
        - `checklocal`: test links against a running local server.
        - `checklinks`: check for invalid links

4. **Working on the Membership UI** (requires the [cf-admin-bot](https://github.com/commonhaus/automation))

    The Vite-related task will watch for changes and recompile updated files. This works well with Lume `serve`,
    just make sure to start Lume first.

    ```bash
    deno task vite-dev
    ```

## Project Structure

- `.github` - build scripts
- `member` - Svelte-based Membership UI. Requires a backend
- `site` - source
    - `_data` - data shared by / available to all pages
        - `about.yml` - maintained by `.github/about.ts`
        - `authors.yml` - maintained by `.github/activities.ts`
        - `bylaws.yml` - sidebar TOC for bylaws (manual)
        - `menu.yml` - site navigation menu (manual)
        - `metas.yml` - default metadata configuration
        - `svg.yml` - common/reusable svg
    - `_includes` - rendering artifacts
        - `layouts` - content layout templates
        - `scss` - sass css fragments
        - `foundation.json` - generated metadata (from git) for files in the foundation submodule
        - `foundation.yml` - metadata sidecar for files that should be rendered on the website (SEO descriptions, specific URL assignments, etc.)
    - `about` - "About the foundation"
        - `_data.ts` - Generated metadata available to pages in this section. This merges information from `foundation/CONTACTS.yaml` and `_data/about.yaml`
        - `index.md` - About Us landing page
        - `branding.md` - Branding guidelines
        - `codehaus.md` - Codehaus legacy
        - Other content placed in this section comes from the `site/foundation` directory (git submodule) care of `mergeFoundationPageData` in `_config.ts`
    - `activity` - Generated pages for discussions and PRs.
        - `_data.yaml` - Common/default metadata for all pages in this section
        - `announcements.md` - Filtered view of announcements
        - `index.md` - Landing page (overview of all activity)
        - `notices.md` - Filtered view of notices
        - other files are generated by `.github/activities.ts`
    - `assets` - static source files (processed by Lume)
    - `community` - empty directory. The landing page for this section is `foundation/COMMUNICATION.md` (See `_includes/foundation.yml`)
    - `foundation` - git submodule. Contains bylaws, policies, and other governance documents. Unmodified. Content is manipulated by `mergeFoundationPageData` in `_config.ts`
    - `static` - static files (copied to output directory)
    - `votes` - generated vote results
        - `<folder>/<discussion>.json` - vote results as json files
        - `index.page.js` - parses all json files in the directory, and creates a page and an svg for each vote result.
- `_config.ts` - Lume site config (static site generation)
- `deno.json` - Deno dependency and task configuration (akin to package.json)
- `vite.config.mjs` - Vite configuration used to build and watch Svelte files for the Membership UI

### Weird things

- **Foundation pages** ('site/foundation') have to render properly in both the original repository (and in pdfs) and on the website. That means, some weirdness.
    - `bylaws.vto` and `foundation.vto` both assume the content already contains the h1/title (which these pages do).
    - `_includes/foundation.json` is generated/updated with the last modified information for the foundation repository.
    - `_includes/foundation.yml` is hand-tended to specify the pages from the foundation repository that should be included in the website (and to specify the URL they should use and provide a meta description, etc.).
- **Activities** are GH Discussions, Pull Requests, and Vote results. All are generated as a result of GraphQL queries.
    - Discussions and Pull Requests are stored as markdown files in the `site/activity` directory.
    - Vote results are captured as JSON files in `site/votes` and then rendered as both html and svg files.
- **Sidebars**:
    - `bylaws.vto` defines a navigation sidebar for bylaws and policies.
    - `activityVote.vto` and `activity.vto` both use `activitySidebar.vto` to define a sidebar for individual activity pages.
- The **Membership UI** (`member/*`) is written with Svelte. It is browser-side only, and built as a secondary step (after Lume). It uses one of the bots as its backend to work with user data (membership application, email alias management, and form-signing).

## Contributing

Once you've set up the project, you're ready to start contributing! Please make sure to read and follow our [Code of Conduct](https://github.com/commonhaus/foundation/?tab=coc-ov-file#readme).

If you're fixing a bug or implementing a feature, please create a branch and submit a pull request. If you're not sure where to start, take a look at the [issues](https://github.com/commonhaus/commonhaus.github.io/issues) in this repository.

Thank you for your contribution!
